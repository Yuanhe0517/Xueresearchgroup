{{/* layouts/section/people.html — people 专用 section 模板（继承主题的 baseof，保留导航栏） */}}
{{ define "main" }}
  {{ $page := . }}

  {{/* 配置 */}}
  {{ $groups := or $page.Params.user_groups (slice "PI" "PhD Student" "Research Assistant") }}
  {{ $sortBy := or $page.Params.sort_by "Title" }}
  {{ $asc    := cond (ne $page.Params.sort_ascending nil) $page.Params.sort_ascending true }}

  {{/* 只从 authors 收集 */}}
  {{ $all := slice }}
  {{ with site.GetPage "section" "authors" }}{{ $all = .Pages }}{{ end }}
  {{ $all = where $all "File" "!=" nil }}

  <section class="people-grid-page people-container">
    {{/* Intentionally hide page title (e.g., "People") */}}

    <style>
      .people-container{max-width:1100px;margin:0 auto;padding:0 1rem;}
      .page-title{margin:2rem 0 1rem;}

      .people-group{margin:3rem 0 1.25rem;text-align:center;}
      .people-group h2{font-size:2rem;margin:0 0 1rem;}

      .people-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:34px;justify-items:center;}
      @media (max-width:1100px){ .people-grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
      @media (max-width:900px){ .people-grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
      @media (max-width:650px){ .people-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }

      .people-card{max-width:220px;text-align:center;}
      .people-card__avatar{display:inline-block;width:170px;height:170px;border-radius:999px;overflow:hidden;background:#f2f2f2;}
      .people-card__avatar img{width:100%;height:100%;object-fit:cover;object-position:center;display:block;}
      .people-card__name{margin:.75rem 0 .25rem;font-size:1.15rem;}
      .people-card__name a{text-decoration:none;}
      .people-card__role{color:#666;font-size:.95rem;}

      .people-card--pi{max-width:920px;margin:0 auto;}
      .people-card--pi .people-card__avatar{width:210px;height:210px;}
      .people-card--pi .people-card__summary{
        margin:1rem auto 0;
        max-width:920px;
        font-size:1rem;
        line-height:1.65;
        text-align:justify;
        text-justify:inter-word;
        color:#444;
      }
    </style>

    {{ if $groups }}
      {{ $any := false }}
      {{ range $g := $groups }}
        {{ $set := slice }}
        {{ range $all }}
          {{ $p := . }}
          {{ $match := false }}
          {{ with $p.Params.user_groups }}
            {{ if (reflect.IsSlice .) }}{{ $match = (in . $g) }}{{ else }}{{ $match = (eq . $g) }}{{ end }}
          {{ end }}
          {{ if $match }}{{ $set = $set | append $p }}{{ end }}
        {{ end }}

        {{ if gt (len $set) 0 }}
          {{ $any = true }}
          <div class="people-group">
            <h2>{{ cond (eq $g "PI") "Principal Investigator" $g }}</h2>
          </div>
          {{ $groupSortBy := $sortBy }}
          {{ if or (eq $g "PhD Student") (eq $g "Research Assistant") }}{{ $groupSortBy = "Weight" }}{{ end }}
          {{ $ordered := cond $asc (sort $set $groupSortBy "asc") (sort $set $groupSortBy "desc") }}

          {{ if eq $g "PI" }}
            {{ range $ordered }}
              {{ partial "people_card_item.html" (dict "p" . "isPI" true) }}
            {{ end }}
          {{ else }}
            <div class="people-grid">
              {{ range $ordered }}
                {{ partial "people_card_item.html" (dict "p" . "isPI" false) }}
              {{ end }}
            </div>
          {{ end }}
        {{ end }}
      {{ end }}

      {{ if not $any }}
        <div class="people-group">
          <h2>All</h2>
        </div>
        {{ $ordered := cond $asc (sort $all $sortBy "asc") (sort $all $sortBy "desc") }}
        <div class="people-grid">
          {{ range $ordered }}
            {{ partial "people_card_item.html" (dict "p" . "isPI" false) }}
          {{ end }}
        </div>
      {{ end }}

    {{ else }}
      {{ $ordered := cond $asc (sort $all $sortBy "asc") (sort $all $sortBy "desc") }}
      <div class="people-grid">
        {{ range $ordered }}
          {{ partial "people_card_item.html" (dict "p" . "isPI" false) }}
        {{ end }}
      </div>
    {{ end }}
  </section>
{{ end }}
